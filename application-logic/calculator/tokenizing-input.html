<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tokenizing Input - How I Built freeCodeCamp&#x27;s Calculator with Elm</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">How I Built freeCodeCamp&#x27;s Calculator with Elm</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="tokenizing-input"><a class="header" href="#tokenizing-input">Tokenizing Input</a></h1>
<p>The calculator tokenizes the user's input. This suggests the use of a <a href="https://en.wikipedia.org/wiki/Finite-state_machine">finite-state machine</a> to help with the tokenization.</p>
<p>Why?</p>
<p>Well, <a href="https://en.wikipedia.org/wiki/Lexical_analysis">lexical analyzers</a> use regular expressions to tokenize a string of characters. Regular expressions are equivalent to finite-state machines. And, rather than a string of characters we have a list of key presses. So the idea is to have the calculator act like a lexical analyzer and use a finite-state machine to tokenize the list of key presses.</p>
<h2 id="the-finite-state-machine"><a class="header" href="#the-finite-state-machine">The Finite-State Machine</a></h2>
<p>It has 5 states. The start state is called <code>Start</code> and it has one final state called <code>Answer</code>. The other states are called <code>Left</code>, <code>Partial</code>, and <code>Right</code>. I represented it as follows:</p>
<pre><code class="language-elm">import Data.Evaluator as E
import Data.Operator exposing (Operator)
import Data.Token exposing (Token)


type Calculator
    = Calculator State


type State
    = Start
    | Left Decimal
    | Partial (List Token) Operator
    | Right (List Token) Operator Decimal
    | Answer (List Token) E.Answer
</code></pre>
<p><code>Left</code> represents the situation when the user is entering their first, leftmost, number.</p>
<p><code>Partial</code> represents the situation when the user just finished entering a number and they pressed an operator key.</p>
<p><code>Right</code> represents the situation when the user is entering the second number for the operator.</p>
<p>Notice that the <code>Answer</code> state keeps track of the full tokenized input as well as the answer produced by the evaluator.</p>
<h2 id="whats-decimal"><a class="header" href="#whats-decimal">What's <code>Decimal</code>?</a></h2>
<p>It's a type to help me tokenize decimal numbers.</p>
<pre><code class="language-elm">type Decimal
    = Whole Int
    | Fractional Int Int Int
</code></pre>
<p>Let's consider an example where the user is entering the decimal number <code>123.456</code>.</p>
<div class="table-wrapper"><table><thead><tr><th>Key Pressed</th><th>Decimal</th><th>Comment</th></tr></thead><tbody>
<tr><td><code>Digit One</code></td><td><code>Whole 1</code></td><td><code>Digit.toInt One = 1</code></td></tr>
<tr><td><code>Digit Two</code></td><td><code>Whole 12</code></td><td><code>1 * 10 + Digit.toInt Two = 12</code></td></tr>
<tr><td><code>Digit Three</code></td><td><code>Whole 123</code></td><td><code>12 * 10 + Digit.toInt Three = 123</code></td></tr>
<tr><td><code>Dot</code></td><td><code>Fractional 123 0 1</code></td><td><code>123 + 0/1 = 123</code></td></tr>
<tr><td><code>Digit Four</code></td><td><code>Fractional 123 4 10</code></td><td><code>123 + 4/10 = 123.4</code></td></tr>
<tr><td><code>Digit Five</code></td><td><code>Fractional 123 45 100</code></td><td><code>123 + 45/100 = 123.45</code></td></tr>
<tr><td><code>Digit Six</code></td><td><code>Fractional 123 456 1000</code></td><td><code>123 + 456/1000 = 123.456</code></td></tr>
</tbody></table>
</div>
<p>If <code>Whole 123</code> and <code>Fractional 123 0 1</code> represent the same number then why change the representation when a <code>Dot</code> is pressed?</p>
<ol>
<li>The pressing of the <code>Dot</code> signals that the user is about to enter the fractional part of the number so it makes sense to initialize everything we'd need to accept the fractional part.</li>
<li><code>Whole 123</code> and <code>Fractional 123 0 1</code> are displayed differently in line 2 of the calculator's display. <code>Whole 123</code> is displayed as <code>123</code> but <code>Fractional 123 0 1</code> is displayed as <code>123.</code>, i.e. it ends with a decimal point.</li>
</ol>
<h2 id="new"><a class="header" href="#new"><code>new</code></a></h2>
<pre><code class="language-elm">new : Calculator
new =
    Calculator Start
</code></pre>
<p>Naturally, the calculator starts off in the <code>Start</code> state.</p>
<h2 id="press"><a class="header" href="#press"><code>press</code></a></h2>
<p>As the user presses keys the calculator should transition between states based on its current state and the key that was pressed. So, for each state, we have to figure out what to do for each key that could be pressed.</p>
<p>Recall <code>Key</code>:</p>
<pre><code class="language-elm">type Key
    = AC
    | Dot
    | Equal
    | Digit Digit
    | Operator Operator
</code></pre>
<p>Recall <code>Digit</code>:</p>
<pre><code class="language-elm">type Digit
    = Zero
    | One
    | Two
    | Three
    | Four
    | Five
    | Six
    | Seven
    | Eight
    | Nine
</code></pre>
<p>Recall <code>Operator</code>:</p>
<pre><code class="language-elm">type Operator
    = Add
    | Sub
    | Mul
    | Div
</code></pre>
<p>And, this is how <code>press</code> is implemented:</p>
<pre><code class="language-elm">import Data.Digit as Digit
import Data.Evaluator as E
import Data.Key exposing (Key(..))
import Data.Operator as Operator exposing (Operator)
import Data.Token as Token exposing (Token)
import Lib.Rational as Rational exposing (Rational)


press : Key -&gt; Calculator -&gt; Calculator
press key (Calculator state) =
    Calculator &lt;| pressHelper key state


pressHelper : Key -&gt; State -&gt; State
pressHelper key state =
    case state of
        Start -&gt;
            case key of
                AC -&gt;
                    Start

                Digit digit -&gt;
                    Left &lt;| Whole &lt;| Digit.toInt digit

                Operator _ -&gt;
                    Start

                Dot -&gt;
                    Left &lt;| Fractional 0 0 1

                Equal -&gt;
                    Start

        Left n -&gt;
            case key of
                AC -&gt;
                    Start

                Digit digit -&gt;
                    let
                        d =
                            Digit.toInt digit
                    in
                    case n of
                        Whole w -&gt;
                            Left &lt;| Whole &lt;| w * 10 + d

                        Fractional w f p -&gt;
                            Left &lt;| Fractional w (f * 10 + d) (p * 10)

                Operator op -&gt;
                    Partial [ Token.Number &lt;| toRational n ] op

                Dot -&gt;
                    case n of
                        Whole w -&gt;
                            Left &lt;| Fractional w 0 1

                        Fractional _ _ _ -&gt;
                            Left n

                Equal -&gt;
                    let
                        r =
                            toRational n
                    in
                    Answer [ Token.Number r ] &lt;| Ok r

        Partial tokens op -&gt;
            case key of
                AC -&gt;
                    Start

                Digit digit -&gt;
                    Right tokens op &lt;| Whole &lt;| Digit.toInt digit

                Operator newOp -&gt;
                    Partial tokens newOp

                Dot -&gt;
                    Right tokens op &lt;| Fractional 0 0 1

                Equal -&gt;
                    Answer tokens &lt;| eval tokens

        Right tokens op n -&gt;
            case key of
                AC -&gt;
                    Start

                Digit digit -&gt;
                    let
                        d =
                            Digit.toInt digit
                    in
                    case n of
                        Whole w -&gt;
                            Right tokens op &lt;| Whole &lt;| w * 10 + d

                        Fractional w f p -&gt;
                            Right tokens op &lt;| Fractional w (f * 10 + d) (p * 10)

                Operator newOp -&gt;
                    let
                        newTokens =
                            Token.Number (toRational n) :: Token.Operator op :: tokens
                    in
                    Partial newTokens newOp

                Dot -&gt;
                    case n of
                        Whole w -&gt;
                            Right tokens op &lt;| Fractional w 0 1

                        Fractional _ _ _ -&gt;
                            Right tokens op n

                Equal -&gt;
                    let
                        newTokens =
                            Token.Number (toRational n) :: Token.Operator op :: tokens
                    in
                    Answer newTokens &lt;| eval newTokens

        Answer _ answer -&gt;
            case key of
                AC -&gt;
                    Start

                Digit digit -&gt;
                    Left &lt;| Whole &lt;| Digit.toInt digit

                Operator op -&gt;
                    case answer of
                        Ok r -&gt;
                            Partial [ Token.Number r ] op

                        Err _ -&gt;
                            state

                Dot -&gt;
                    Left &lt;| Fractional 0 0 1

                Equal -&gt;
                    state


eval : List Token -&gt; E.Answer
eval =
    E.eval &lt;&lt; List.reverse
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../application-logic/calculator/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../application-logic/calculator/displaying-output.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../application-logic/calculator/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../application-logic/calculator/displaying-output.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
